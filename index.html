import React, { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Select, SelectTrigger, SelectValue, SelectContent, SelectItem } from "@/components/ui/select";

const courses = [
  {
    name: "Pebble Beach",
    pars: [4, 4, 3, 5, 4, 4, 3, 4, 5, 4, 4, 3, 4, 5, 4, 4, 3, 5]
  },
  {
    name: "St. Andrews",
    pars: [4, 5, 4, 3, 4, 4, 5, 3, 4, 4, 3, 4, 5, 4, 3, 4, 4, 5]
  },
  {
    name: "Augusta National",
    pars: [4, 3, 5, 4, 4, 5, 3, 4, 4, 4, 5, 4, 3, 4, 4, 3, 5, 4]
  },
  {
    name: "Torrey Pines",
    pars: [4, 4, 5, 3, 4, 4, 3, 5, 4, 4, 4, 3, 5, 4, 4, 3, 4, 5]
  },
  {
    name: "TPC Sawgrass",
    pars: [4, 4, 3, 5, 4, 4, 5, 3, 4, 4, 5, 3, 4, 4, 3, 5, 4, 4]
  },
  {
    name: "Bethpage Black",
    pars: [4, 4, 5, 3, 4, 5, 3, 4, 4, 4, 4, 3, 5, 4, 3, 5, 4, 4]
  },
  {
    name: "Pinehurst No. 2",
    pars: [4, 3, 4, 5, 4, 4, 3, 4, 5, 4, 3, 5, 4, 4, 3, 4, 5, 4]
  },
  {
    name: "Whistling Straits",
    pars: [4, 4, 5, 3, 4, 4, 5, 3, 4, 5, 4, 3, 4, 4, 5, 4, 3, 4]
  },
  {
    name: "Royal Melbourne",
    pars: [4, 3, 5, 4, 4, 3, 5, 4, 4, 3, 4, 5, 4, 4, 3, 4, 4, 5]
  },
  {
    name: "Bandon Dunes",
    pars: [4, 4, 3, 5, 4, 3, 4, 5, 4, 4, 5, 3, 4, 4, 3, 5, 4, 4]
  }
];

const NUM_HOLES = 18;
const NUM_PLAYERS = 4;

export default function Scorecard() {
  const [selectedCourse, setSelectedCourse] = useState(courses[0]);
  const [scores, setScores] = useState(
    Array.from({ length: NUM_PLAYERS }, () => Array(NUM_HOLES).fill(""))
  );
  const [playerNames, setPlayerNames] = useState([
    "Player 1",
    "Player 2",
    "Player 3",
    "Player 4"
  ]);

  const handleScoreChange = (playerIndex, holeIndex, value) => {
    const newScores = [...scores];
    newScores[playerIndex][holeIndex] = value;
    setScores(newScores);
  };

  const calculateTotal = (playerIndex) => {
    return scores[playerIndex].reduce((total, score) => {
      const parsed = parseInt(score);
      return total + (isNaN(parsed) ? 0 : parsed);
    }, 0);
  };

  const calculateParDiff = (playerIndex) => {
    let diff = 0;
    scores[playerIndex].forEach((score, idx) => {
      const parsed = parseInt(score);
      if (!isNaN(parsed)) {
        diff += parsed - selectedCourse.pars[idx];
      }
    });
    return diff > 0 ? `+${diff}` : diff < 0 ? `${diff}` : "0";
  };

  return (
    <Card className="overflow-x-auto">
      <CardContent>
        <div className="mb-4">
          <Label htmlFor="course">Select Course</Label>
          <Select
            onValueChange={(value) => {
              const course = courses.find((c) => c.name === value);
              if (course) setSelectedCourse(course);
            }}
          >
            <SelectTrigger className="w-[300px]">
              <SelectValue placeholder={selectedCourse.name} />
            </SelectTrigger>
            <SelectContent>
              {courses.map((course) => (
                <SelectItem key={course.name} value={course.name}>
                  {course.name}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>

        <div className="overflow-x-auto">
          <table className="table-auto border-collapse w-full text-sm">
            <thead>
              <tr className="bg-gray-300">
                <th className="p-1 border" rowSpan={2}></th>
                {Array.from({ length: NUM_HOLES }).map((_, i) => (
                  <th key={i} className="p-1 border text-center align-middle">
                    Hole {i + 1}
                  </th>
                ))}
                <th className="p-1 border text-center align-middle" rowSpan={2}>
                  Total
                </th>
                <th className="p-1 border text-center align-middle" rowSpan={2}>
                  +/- Par
                </th>
              </tr>
              <tr className="bg-gray-200">
                {selectedCourse.pars.map((par, i) => (
                  <td key={i} className="p-1 border text-center align-middle">
                    Par {par}
                  </td>
                ))}
              </tr>
            </thead>
            <tbody>
              {scores.map((playerScores, playerIdx) => (
                <tr key={playerIdx}>
                  <td className="p-1 border min-w-[90px]">
                    <Input
                      value={playerNames[playerIdx]}
                      onChange={(e) => {
                        const newNames = [...playerNames];
                        newNames[playerIdx] = e.target.value;
                        setPlayerNames(newNames);
                      }}
                      className="text-xs w-full"
                    />
                  </td>
                  {playerScores.map((score, holeIdx) => {
                    const diff =
                      score === ""
                        ? ""
                        : parseInt(score) - selectedCourse.pars[holeIdx];
                    const borderColor =
                      diff < 0
                        ? "border-green-500"
                        : diff > 0
                        ? "border-red-500"
                        : "border-gray-300";
                    return (
                      <td key={holeIdx} className={`p-1 border ${borderColor}`}>
                        <Input
                          type="number"
                          value={score}
                          onChange={(e) =>
                            handleScoreChange(playerIdx, holeIdx, e.target.value)
                          }
                          className="text-center text-xs w-[50px] h-[30px]"
                        />
                      </td>
                    );
                  })}
                  <td className="p-1 border text-center text-sm font-bold">
                    {calculateTotal(playerIdx)}
                  </td>
                  <td className="p-1 border text-center text-sm font-bold">
                    {calculateParDiff(playerIdx)}
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </CardContent>
    </Card>
  );
}
