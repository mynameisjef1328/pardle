import React, { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";

const courses = {
  "Pebble Beach": [4, 5, 4, 3, 4, 4, 3, 4, 4, 4, 5, 3, 4, 4, 4, 4, 3, 5],
  "Augusta National": [4, 4, 3, 5, 4, 4, 5, 3, 4, 5, 3, 4, 4, 4, 4, 3, 4, 5],
  "St. Andrews": [4, 5, 4, 3, 4, 3, 5, 4, 4, 4, 4, 5, 3, 3, 4, 5, 4, 4],
  "Bethpage Black": [4, 3, 5, 4, 4, 5, 4, 3, 4, 5, 4, 3, 4, 4, 4, 3, 5, 4],
  "TPC Sawgrass": [4, 5, 4, 3, 4, 4, 3, 4, 4, 4, 3, 5, 4, 4, 4, 3, 4, 5],
  "Pinehurst No. 2": [4, 3, 4, 4, 5, 4, 3, 4, 4, 5, 4, 4, 3, 4, 4, 5, 3, 4],
  "Bandon Dunes": [4, 4, 3, 5, 4, 4, 3, 5, 4, 3, 4, 5, 4, 4, 3, 4, 4, 5],
  "Whistling Straits": [5, 4, 3, 4, 4, 5, 4, 3, 4, 4, 5, 4, 4, 4, 3, 4, 4, 5],
  "Chambers Bay": [5, 3, 4, 4, 4, 5, 4, 3, 4, 4, 5, 3, 4, 4, 4, 4, 3, 5],
  "Torrey Pines": [5, 4, 4, 3, 4, 4, 4, 5, 3, 5, 4, 3, 4, 4, 4, 3, 4, 5],
};

const NUM_HOLES = 18;
const NUM_PLAYERS = 4;

export default function Scorecard() {
  const [selectedCourse, setSelectedCourse] = useState("Pebble Beach");
  const [scores, setScores] = useState(
    Array(NUM_PLAYERS)
      .fill()
      .map(() => Array(NUM_HOLES).fill(""))
  );

  const handleScoreChange = (playerIndex, holeIndex, value) => {
    const newScores = [...scores];
    newScores[playerIndex][holeIndex] = value;
    setScores(newScores);
  };

  const calculateTotal = (playerScores) => {
    return playerScores.reduce((acc, val) => acc + (parseInt(val) || 0), 0);
  };

  const calculateParDiff = (playerScores) => {
    const par = courses[selectedCourse];
    const diff = playerScores.reduce(
      (acc, val, idx) => acc + ((parseInt(val) || 0) - par[idx]),
      0
    );
    if (diff > 0) return "+" + diff;
    if (diff < 0) return diff;
    return "0";
  };

  const par = courses[selectedCourse];

  return (
    <Card className="overflow-x-auto">
      <CardContent className="p-4">
        <div className="mb-4">
          <Label className="text-md font-bold">Select Course</Label>
          <Select value={selectedCourse} onValueChange={setSelectedCourse}>
            <SelectTrigger className="w-[260px]">
              <SelectValue placeholder="Select a course" />
            </SelectTrigger>
            <SelectContent>
              {Object.keys(courses).map((course) => (
                <SelectItem key={course} value={course}>
                  {course}
                </SelectItem>
              ))}
            </SelectContent>
          </Select>
        </div>

        <table className="table-auto border-collapse w-full text-xs md:text-sm">
          <thead>
            <tr className="bg-gray-300 text-center">
              <th className="border px-1 md:px-2">Hole</th>
              {Array.from({ length: NUM_HOLES }, (_, i) => (
                <th className="border px-1 md:px-2" key={i}>
                  {i + 1}
                </th>
              ))}
              <th className="border px-1 md:px-2">Total</th>
              <th className="border px-1 md:px-2">+/â€“</th>
            </tr>
            <tr className="bg-gray-200 text-center">
              <th className="border px-1 md:px-2">Par</th>
              {par.map((p, i) => (
                <td key={i} className="border px-1 md:px-2">
                  {p}
                </td>
              ))}
              <td className="border px-1 md:px-2 font-bold">
                {par.reduce((a, b) => a + b, 0)}
              </td>
              <td className="border px-1 md:px-2 font-bold">0</td>
            </tr>
          </thead>
          <tbody>
            {scores.map((playerScores, playerIndex) => (
              <tr key={playerIndex}>
                <td className="border px-1 md:px-2">
                  <Input
                    type="text"
                    placeholder={`Player ${playerIndex + 1}`}
                    className="w-full text-xs"
                  />
                </td>
                {playerScores.map((score, holeIndex) => {
                  const parValue = par[holeIndex];
                  const intScore = parseInt(score);
                  const diff = intScore - parValue;
                  let className = "border text-center align-middle text-xs md:text-sm";
                  if (!isNaN(intScore)) {
                    if (diff < 0) className += " border-b-4 border-green-500";
                    else if (diff > 0) className += " border-b-4 border-red-500";
                  }
                  return (
                    <td key={holeIndex} className={className}>
                      <Input
                        type="number"
                        value={score}
                        onChange={(e) =>
                          handleScoreChange(playerIndex, holeIndex, e.target.value)
                        }
                        className="text-center text-xs md:text-sm h-6"
                      />
                    </td>
                  );
                })}
                <td className="border px-1 md:px-2 text-center font-bold">
                  {calculateTotal(playerScores)}
                </td>
                <td className="border px-1 md:px-2 text-center font-bold">
                  {calculateParDiff(playerScores)}
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </CardContent>
    </Card>
  );
}
