import React, { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import {
  Select,
  SelectContent,
  SelectItem,
  SelectTrigger,
  SelectValue,
} from "@/components/ui/select";

const courses = {
  "Pebble Peach": [4, 5, 3, 4, 4, 4, 3, 4, 4, 4, 5, 3, 4, 4, 4, 3, 4, 5],
  "August Alphabet": [4, 4, 3, 5, 4, 4, 3, 4, 4, 5, 4, 3, 4, 4, 5, 4, 4, 5],
  "Bethpage Blackletter": [4, 4, 5, 4, 3, 4, 5, 4, 4, 5, 4, 3, 4, 4, 3, 5, 4, 5],
  "TPC Swipeword": [4, 4, 3, 5, 4, 4, 3, 4, 4, 4, 5, 3, 4, 4, 4, 3, 4, 5],
  "Pinehurst No. 2nd Letter": [4, 4, 5, 3, 4, 4, 3, 5, 4, 4, 5, 3, 4, 4, 3, 4, 4, 5],
  "Torrey Tiles": [5, 4, 3, 4, 4, 5, 3, 4, 4, 4, 5, 3, 4, 4, 5, 4, 4, 5],
  "St. Ampersands": [4, 4, 5, 4, 3, 4, 4, 3, 5, 4, 4, 3, 4, 4, 5, 4, 4, 5],
  "Chambers Brain": [4, 5, 3, 4, 4, 4, 3, 4, 4, 5, 4, 3, 4, 5, 4, 4, 3, 4],
  "Whistling Swears": [5, 4, 3, 4, 4, 5, 3, 4, 4, 5, 4, 3, 4, 5, 3, 4, 4, 5],
  "Bully Big Words": [4, 5, 4, 3, 4, 5, 3, 4, 4, 5, 4, 3, 4, 4, 4, 3, 4, 5],
};

const NUM_HOLES = 18;
const NUM_PLAYERS = 4;

export default function Scorecard() {
  const [selectedCourse, setSelectedCourse] = useState("Pebble Peach");
  const [scores, setScores] = useState(
    Array(NUM_PLAYERS)
      .fill()
      .map(() => Array(NUM_HOLES).fill(""))
  );

  const handleScoreChange = (playerIndex, holeIndex, value) => {
    const newScores = [...scores];
    newScores[playerIndex][holeIndex] = value;
    setScores(newScores);
  };

  const calculateTotal = (playerScores) => {
    return playerScores.reduce((acc, val) => acc + (parseInt(val) || 0), 0);
  };

  const calculateParDiff = (playerScores) => {
    const par = courses[selectedCourse];
    const diff = playerScores.reduce(
      (acc, val, idx) => acc + ((parseInt(val) || 0) - par[idx]),
      0
    );
    if (diff > 0) return "+" + diff;
    if (diff < 0) return `${diff}`;
    return "0";
  };

  const par = courses[selectedCourse];
  const parTotal = par.reduce((a, b) => a + b, 0);

  return (
    <div className="overflow-x-auto p-4">
      <Card className="w-full">
        <CardContent className="p-4">
          <div className="mb-4">
            <Label htmlFor="course">Select Course</Label>
            <Select onValueChange={(value) => setSelectedCourse(value)}>
              <SelectTrigger id="course">
                <SelectValue placeholder="Select a course" />
              </SelectTrigger>
              <SelectContent>
                {Object.keys(courses).map((course) => (
                  <SelectItem key={course} value={course}>
                    {course}
                  </SelectItem>
                ))}
              </SelectContent>
            </Select>
          </div>
          <div className="overflow-auto">
            <table className="min-w-full border-collapse border text-sm">
              <thead>
                <tr className="bg-gray-300">
                  <th className="p-2 text-center">Hole</th>
                  {Array.from({ length: NUM_HOLES }, (_, i) => (
                    <th key={i} className="p-2 text-center">
                      {i + 1}
                    </th>
                  ))}
                  <th className="p-2 text-center">Par</th>
                  <th className="p-2 text-center">Total</th>
                  <th className="p-2 text-center">+/-</th>
                </tr>
              </thead>
              <tbody>
                <tr className="bg-gray-200">
                  <td className="p-2 text-center font-bold">Par</td>
                  {par.map((p, i) => (
                    <td key={i} className="p-2 text-center">
                      {p}
                    </td>
                  ))}
                  <td className="p-2 text-center font-bold">{parTotal}</td>
                  <td></td>
                  <td></td>
                </tr>
                {scores.map((playerScores, playerIndex) => (
                  <tr key={playerIndex}>
                    <td className="p-2 text-center font-bold">{String.fromCharCode(65 + playerIndex)}</td>
                    {playerScores.map((score, holeIndex) => {
                      const parValue = par[holeIndex];
                      const intScore = parseInt(score);
                      const diff = intScore - parValue;
                      let className = "border p-1 text-center";
                      if (!isNaN(intScore)) {
                        if (diff < 0) className += " border-b-4 border-green-500";
                        else if (diff > 0) className += " border-b-4 border-red-500";
                      }
                      return (
                        <td key={holeIndex} className={className}>
                          <Input
                            type="number"
                            value={score}
                            onChange={(e) =>
                              handleScoreChange(playerIndex, holeIndex, e.target.value)
                            }
                            className="text-center text-sm"
                          />
                        </td>
                      );
                    })}
                    <td className="p-2 text-center font-bold">{calculateTotal(playerScores)}</td>
                    <td className="p-2 text-center font-bold">{calculateParDiff(playerScores)}</td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </CardContent>
      </Card>
    </div>
  );
}
