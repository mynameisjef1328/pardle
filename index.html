import React, { useState } from "react";
import { Card, CardContent } from "@/components/ui/card";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from "@/components/ui/select";

const courses = {
  "Pebble Beach": [4, 5, 3, 4, 4, 5, 3, 4, 4, 4, 3, 5, 4, 4, 3, 4, 5, 4],
  "Augusta National": [4, 4, 3, 5, 4, 3, 4, 5, 4, 3, 5, 4, 4, 4, 3, 5, 4, 4],
  "St. Andrews": [4, 4, 5, 3, 4, 4, 5, 3, 4, 4, 3, 5, 4, 3, 4, 4, 5, 4],
  "Torrey Pines": [5, 4, 3, 4, 4, 3, 4, 5, 4, 4, 4, 3, 5, 4, 4, 3, 4, 5],
  "Bethpage Black": [4, 5, 4, 3, 4, 4, 5, 3, 4, 4, 3, 4, 5, 4, 4, 3, 4, 5],
  "TPC Sawgrass": [4, 4, 5, 3, 4, 3, 5, 4, 4, 5, 4, 3, 4, 3, 4, 5, 4, 4],
  "Pinehurst No. 2": [4, 4, 3, 5, 4, 4, 3, 4, 5, 3, 4, 4, 4, 5, 4, 3, 4, 4],
  "Bandon Dunes": [4, 4, 5, 3, 4, 3, 5, 4, 4, 4, 3, 5, 4, 4, 3, 4, 4, 5],
  "Whistling Straits": [5, 4, 4, 3, 4, 4, 3, 5, 4, 3, 5, 4, 4, 4, 3, 5, 4, 4],
  "Chambers Bay": [4, 5, 3, 4, 4, 5, 3, 4, 4, 4, 4, 3, 5, 4, 4, 3, 4, 5]
};

const NUM_HOLES = 18;
const NUM_PLAYERS = 4;

export default function Scorecard() {
  const [selectedCourse, setSelectedCourse] = useState("Pebble Beach");
  const [scores, setScores] = useState(
    Array(NUM_PLAYERS)
      .fill()
      .map(() => Array(NUM_HOLES).fill(""))
  );

  const handleScoreChange = (playerIndex, holeIndex, value) => {
    const newScores = [...scores];
    newScores[playerIndex][holeIndex] = value;
    setScores(newScores);
  };

  const calculateTotal = (playerScores) => {
    return playerScores.reduce((acc, val) => acc + (parseInt(val) || 0), 0);
  };

  const calculateParDiff = (playerScores) => {
    const par = courses[selectedCourse];
    const diff = playerScores.reduce((acc, val, idx) => acc + ((parseInt(val) || 0) - par[idx]), 0);
    if (diff > 0) return `+${diff}`;
    if (diff < 0) return `${diff}`;
    return "0";
  };

  const par = courses[selectedCourse];

  return (
    <div className="overflow-x-auto p-4">
      <div className="mb-4 w-64">
        <Label htmlFor="course">Select Course</Label>
        <Select value={selectedCourse} onValueChange={setSelectedCourse}>
          <SelectTrigger className="w-full text-lg">
            <SelectValue placeholder="Select a course" />
          </SelectTrigger>
          <SelectContent>
            {Object.keys(courses).map((course) => (
              <SelectItem key={course} value={course}>
                {course}
              </SelectItem>
            ))}
          </SelectContent>
        </Select>
      </div>

      <Card className="w-full">
        <CardContent className="overflow-x-auto p-2">
          <table className="min-w-full table-auto border-collapse text-center">
            <thead>
              <tr>
                <th className="w-24 border p-1"></th>
                {Array.from({ length: NUM_HOLES }, (_, i) => (
                  <th key={i} className="w-12 border p-1 align-middle">Hole {i + 1}</th>
                ))}
                <th className="w-24 border p-1">Total</th>
                <th className="w-24 border p-1">+/â€“</th>
              </tr>
              <tr>
                <td className="border p-1 font-bold">Par</td>
                {par.map((p, i) => (
                  <td key={i} className="border p-1 font-bold align-middle">{p}</td>
                ))}
                <td className="border p-1 font-bold">{par.reduce((a, b) => a + b, 0)}</td>
                <td className="border p-1 font-bold">0</td>
              </tr>
            </thead>
            <tbody>
              {scores.map((playerScores, playerIndex) => (
                <tr key={playerIndex}>
                  <td className="border p-1">
                    <Input
                      defaultValue={`Player ${playerIndex + 1}`}
                      className="text-sm"
                    />
                  </td>
                  {playerScores.map((score, holeIndex) => {
                    const parValue = par[holeIndex];
                    const intScore = parseInt(score);
                    const diff = intScore - parValue;
                    let className = "border p-1";
                    if (!isNaN(intScore)) {
                      if (diff < 0) className += " border-b-4 border-green-500";
                      else if (diff > 0) className += " border-b-4 border-red-500";
                    }
                    return (
                      <td key={holeIndex} className={className + " align-middle text-center"}>
                        <Input
                          type="number"
                          value={score}
                          onChange={(e) => handleScoreChange(playerIndex, holeIndex, e.target.value)}
                          className="text-center text-sm"
                        />
                      </td>
                    );
                  })}
                  <td className="border p-1 font-bold align-middle">{calculateTotal(playerScores)}</td>
                  <td className="border p-1 font-bold align-middle">{calculateParDiff(playerScores)}</td>
                </tr>
              ))}
            </tbody>
          </table>
        </CardContent>
      </Card>
    </div>
  );
}
