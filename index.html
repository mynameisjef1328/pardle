<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Pardle</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Firebase SDKs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>

    <style>
:root {
  --bg: #181818;
  --bg-card: #202024;
  --text: #fff;
  --accent: #ff9800;
  --accent-hover: #ffa726;
  --border-soft: #222;
  --modal-bg: rgba(0,0,0,0.32);
}
body {
  background: var(--bg);
  color: var(--text);
  font-family: -apple-system,BlinkMacSystemFont,"Inter",sans-serif;
  margin: 0;
  min-height: 100vh;
  letter-spacing: 0.01em;
}
a { color: var(--accent); text-decoration: none; }
.landing-overlay {
  position: fixed;
  inset: 0;
  background: var(--bg);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 2000;
}
.landing-card {
  background: var(--bg-card);
  padding: 2.5em 2em 2em 2em;
  border-radius: 24px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.28);
  display: flex;
  flex-direction: column;
  align-items: center;
  min-width: 320px;
  min-height: 240px;
  animation: fadeInUp 0.4s cubic-bezier(.22,1,.36,1);
}
@keyframes fadeInUp {
  0% { opacity: 0; transform: translateY(32px);}
  100% { opacity: 1; transform: none;}
}
.landing-title {
  color: #fff;
  font-size: 2.1rem;
  font-weight: 700;
  margin-bottom: 2rem;
  letter-spacing: 0.04em;
}
.landing-play-btn {
  width: 100%;
  font-size: 1.17rem;
  background: var(--accent);
  color: #fff;
  padding: 0.9em 0;
  border-radius: 14px;
  border: none;
  font-weight: 700;
  margin-bottom: 1.1rem;
  cursor: pointer;
  box-shadow: 0 2px 12px rgba(255,152,0,0.11);
  transition: background 0.18s;
}
.landing-play-btn:hover,
.landing-play-btn:focus {
  background: var(--accent-hover);
  outline: none;
}
.landing-join-link {
  color: #ccc;
  font-size: 1rem;
  text-decoration: underline;
  cursor: pointer;
  margin-top: 0.4rem;
  opacity: 0.88;
  transition: color 0.18s, opacity 0.18s;
}
.landing-join-link:hover,
.landing-join-link:focus {
  color: var(--accent);
  opacity: 1;
}
.app-shell {
  max-width: 540px;
  margin: 2.3rem auto;
  background: var(--bg-card);
  border-radius: 18px;
  box-shadow: 0 4px 28px rgba(0,0,0,0.21);
  padding: 1.3rem 1.6rem 2.2rem 1.6rem;
}
.app-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 2rem;
  border-bottom: 1.5px solid var(--border-soft);
  padding-bottom: 0.7rem;
}
.app-title {
  font-size: 1.6rem;
  font-weight: 600;
  letter-spacing: 0.04em;
}
.header-actions {
  display: flex;
  gap: 0.5em;
}
.card {
  background: var(--bg-card);
  border-radius: 12px;
  padding: 1.5rem;
  box-shadow: 0 2px 8px rgba(0,0,0,0.10);
  margin-bottom: 1.5rem;
}
.online-grid {
  min-height: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.online-grid h2 {
  font-weight: 500;
  color: #fff;
  opacity: 0.88;
}
.modal-overlay {
  position: fixed;
  inset: 0;
  background: var(--modal-bg);
  align-items: center;
  justify-content: center;
  z-index: 3000;
  display: none; /* Controlled inline by JS */
}
.modal-card {
  background: var(--bg-card);
  border-radius: 24px;
  box-shadow: 0 8px 32px rgba(0,0,0,0.13);
  padding: 2.5rem 2rem 2rem 2rem;
  width: 350px;
  max-width: 92vw;
  display: flex;
  flex-direction: column;
  align-items: stretch;
  gap: 1.2rem;
  animation: fadeInUp 0.33s cubic-bezier(.21,1,.22,1);
}
.modal-title {
  margin: 0 0 0.4rem 0;
  font-size: 1.4rem;
  font-weight: 700;
  text-align: center;
  color: #fff;
  letter-spacing: 0.04em;
}
.modal-input {
  font-size: 1.13rem;
  padding: 0.7em 1em;
  border: 1.5px solid #333;
  border-radius: 12px;
  outline: none;
  background: #222;
  color: #fff;
  margin-bottom: 0.7rem;
  width: 100%;
  box-sizing: border-box;
  transition: border-color 0.2s;
}
.modal-input:focus { border-color: var(--accent); }
.modal-btn, .modal-btn-cancel {
  font-size: 1.08rem;
  padding: 0.7em 1em;
  margin-top: 0.25rem;
  border: none;
  border-radius: 11px;
  cursor: pointer;
  font-weight: 600;
  background: var(--accent);
  color: #fff;
  transition: background 0.2s, color 0.2s;
}
.modal-btn-cancel {
  background: #444;
  color: #fff;
  margin-top: 0.4rem;
}
.modal-btn:active, .modal-btn-cancel:active {
  opacity: 0.8;
}
.modal-error {
  color: #ff5252;
  font-size: 1rem;
  text-align: center;
  margin-top: 0.5rem;
  min-height: 1.3em;
}
  </style>
</head>

<body data-mode="dark" data-accent="normal">

  <!-- ===== LANDING OVERLAY ===== -->
  <div id="landingCard" class="landing-overlay">
    <div class="landing-card">
      <h1 class="landing-title">Pardle</h1>
      <button class="landing-play-btn" onclick="onLandingPlay()">Play</button>
      <a href="#" class="landing-join-link" onclick="onLandingJoin(event)">Join Game</a>
    </div>
  </div>

  <!-- ===== MAIN APP ===== -->
  <div id="mainApp" style="display:none;">
    <div class="app-shell">
      <header class="app-header">
        <div class="app-title">Pardle</div>
        <div class="header-actions">
          <button id="analyticsButton" class="icon-btn icon-btn-analytics" type="button" aria-label="View round stats">
            <span class="bar left"></span>
            <span class="bar middle"></span>
            <span class="bar right"></span>
          </button>
          <button id="settingsButton" class="icon-btn icon-btn-gear" type="button" aria-label="Settings">
            <span>âš™</span>
          </button>
          <button class="modal-btn" onclick="showJoinGameModal()" style="margin-left:8px;">
            Join Game
          </button>
        </div>
      </header>
      <main class="app-content">
        <section class="card">
          <div class="online-grid" id="pardleScorecardContainer">
            <!-- App will render the scorecard here -->
          </div>
        </section>
      </main>
    </div>
  </div>

  <!-- ===== JOIN GAME MODAL ===== -->
  <div id="joinGameModal" class="modal-overlay" style="display:none;">
    <div class="modal-card">
      <h2 class="modal-title">Join a Game</h2>
      <form id="joinGameForm" autocomplete="off">
        <input
          type="text"
          id="joinGameIdInput"
          class="modal-input"
          maxlength="8"
          placeholder="Enter Game ID"
          required
        />
        <button type="submit" class="modal-btn">Join</button>
        <button type="button" class="modal-btn-cancel" id="cancelJoinGameBtn">Cancel</button>
      </form>
      <div id="joinGameError" class="modal-error" style="display:none;"></div>
    </div>
  </div>

    <script>
  // ==============================
  // FIREBASE CONFIG & INIT
  // ==============================

  const firebaseConfig = {
    apiKey: "AIzaSyDxmmTSpvM1xvVRb8qiOQfbbQWHSJEgIrk",
    authDomain: "pardle-online.firebaseapp.com",
    projectId: "pardle-online",
    storageBucket: "pardle-online.firebasestorage.app",
    messagingSenderId: "552026596516",
    appId: "1:552026596516:web:779d08f94ef455eda7f231"
    measurementId: "G-SJLZZ84L8F"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const firestore = firebase.firestore();

  // ==============================
  // PARDLE APP CONSTANTS
  // ==============================
  const NUM_HOLES = 18;
  const DEFAULT_PAR = [4,4,3,5,4,4,3,5,4,4,4,3,5,4,4,3,5,4]; // Change for your course

  function generateGameId(len = 7) {
    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
    let id = '';
    for (let i = 0; i < len; ++i) id += chars[Math.floor(Math.random() * chars.length)];
    return id;
  }

  // ===============================
  // ONBOARDING: Landing/Modal Logic
  // ===============================

  window.onload = function() {
    document.getElementById('landingCard').style.display = '';
    document.getElementById('mainApp').style.display = 'none';
    document.getElementById('joinGameModal').style.display = 'none';
  };

  window.onLandingPlay = function() {
    document.getElementById('landingCard').style.display = 'none';
    showCreateGamePrompt();
  };

  window.onLandingJoin = function(e) {
    e.preventDefault();
    document.getElementById('landingCard').style.display = 'none';
    document.getElementById('mainApp').style.display = '';
    showJoinGameModal();
  };

  // ===============================
  // JOIN GAME MODAL LOGIC
  // ===============================
  const joinGameModal = document.getElementById('joinGameModal');
  const joinGameForm = document.getElementById('joinGameForm');
  const joinGameIdInput = document.getElementById('joinGameIdInput');
  const joinGameError = document.getElementById('joinGameError');
  const cancelJoinGameBtn = document.getElementById('cancelJoinGameBtn');

  window.showJoinGameModal = function() {
    joinGameModal.style.display = 'flex';
    joinGameIdInput.value = '';
    joinGameError.style.display = 'none';
    setTimeout(() => joinGameIdInput.focus(), 10);
  };
  window.hideJoinGameModal = function() {
    joinGameModal.style.display = 'none';
  };
  if (cancelJoinGameBtn) cancelJoinGameBtn.addEventListener('click', hideJoinGameModal);

  if (joinGameForm) joinGameForm.addEventListener('submit', function(e) {
    e.preventDefault();
    const gameId = joinGameIdInput.value.trim().toUpperCase();
    joinGameError.style.display = 'none';

    if (!/^[A-Z0-9]{4,8}$/.test(gameId)) {
      joinGameError.textContent = 'Please enter a valid Game ID.';
      joinGameError.style.display = 'block';
      return;
    }

    firestore.collection('games').doc(gameId).get().then(doc => {
      if (!doc.exists) {
        joinGameError.textContent = 'Game not found. Try again.';
        joinGameError.style.display = 'block';
        return;
      }
      joinGameModal.style.display = 'none';
      document.getElementById('mainApp').style.display = '';
      loadGame(gameId);
    }).catch(() => {
      joinGameError.textContent = 'Could not join game. Try again.';
      joinGameError.style.display = 'block';
    });
  });

  // ===============================
  // CREATE GAME FLOW
  // ===============================
  function showCreateGamePrompt() {
    const container = document.getElementById('pardleScorecardContainer');
    container.innerHTML = `
      <div style="width:100%;text-align:center;">
        <form id="playerNameForm" autocomplete="off">
          <label for="playerNameInput" style="font-size:1.1rem;">Your name to start:</label>
          <input type="text" id="playerNameInput" class="modal-input" maxlength="20" style="margin:1em 0;display:block;width:100%;max-width:220px;margin-left:auto;margin-right:auto;" required placeholder="e.g., El Jefe">
          <button type="submit" class="landing-play-btn" style="width:130px;">Start</button>
        </form>
      </div>
    `;
    document.getElementById('mainApp').style.display = '';
    const playerNameForm = document.getElementById('playerNameForm');
    const playerNameInput = document.getElementById('playerNameInput');
    if (playerNameInput) playerNameInput.focus();

    playerNameForm.onsubmit = function(ev) {
      ev.preventDefault();
      const playerName = playerNameInput.value.trim();
      if (!playerName) return playerNameInput.focus();
      const gameId = generateGameId();
      const playerId = 'player_' + Math.random().toString(36).substr(2,9);
      firestore.collection('games').doc(gameId).set({
        created: firebase.firestore.FieldValue.serverTimestamp(),
        status: 'active',
        holes: NUM_HOLES,
        par: DEFAULT_PAR,
        players: {
          [playerId]: {
            name: playerName,
            scores: Array(NUM_HOLES).fill(""),
            joined: firebase.firestore.FieldValue.serverTimestamp()
          }
        }
      }).then(() => {
        sessionStorage.setItem('pardle_playerId', playerId);
        loadGame(gameId);
      });
    };
  }

  // ===============================
  // LOAD GAME & REAL-TIME SCORECARD
  // ===============================
  let unsubscribeGame = null;
  function loadGame(gameId) {
    if (unsubscribeGame) unsubscribeGame();
    unsubscribeGame = firestore.collection('games').doc(gameId)
      .onSnapshot(doc => {
        if (!doc.exists) {
          showError("Game not found or was deleted.");
          return;
        }
        renderScorecard(gameId, doc.data());
      });
  }

  // ===============================
  // SCORECARD RENDER/UPDATE LOGIC
  // ===============================
  function renderScorecard(gameId, gameData) {
    const container = document.getElementById('pardleScorecardContainer');
    if (!gameData || !gameData.players) {
      container.innerHTML = "<div>No game data found.</div>";
      return;
    }
    const playerIds = Object.keys(gameData.players);
    const holes = gameData.holes || NUM_HOLES;
    const par = gameData.par || DEFAULT_PAR;

    let html = `<div style="display:flex;justify-content:space-between;align-items:center;">
      <div style="font-size:1.3em;font-weight:600;letter-spacing:0.05em;">Game ID: ${gameId}</div>
      <button class="modal-btn-cancel" onclick="copyToClipboard('${gameId}')">Copy Game ID</button>
    </div>
    <table style="width:100%;margin-top:1.2em;border-collapse:collapse;">
      <thead>
        <tr>
          <th style="text-align:left;">Player</th>`;
    for (let h=0; h<holes; ++h) html += `<th style="text-align:center;">${h+1}</th>`;
    html += `<th style="text-align:center;">Total</th></tr></thead><tbody>`;

    for (let pid of playerIds) {
      const p = gameData.players[pid];
      html += `<tr><td>${p.name || 'Player'}</td>`;
      let total = 0;
      for (let h=0; h<holes; ++h) {
        const score = p.scores && p.scores[h] !== undefined ? p.scores[h] : "";
        html += `<td style="text-align:center;">${pid === sessionStorage.getItem('pardle_playerId') ? 
          `<input type="number" min="1" max="15" style="width:2.5em;" value="${score}" data-hole="${h}" data-player="${pid}" class="score-input">`
          : (score !== "" ? score : "-")
        }</td>`;
        if (score !== "" && !isNaN(Number(score))) total += Number(score);
      }
      html += `<td style="text-align:center;font-weight:600;">${total}</td></tr>`;
    }
    html += `</tbody></table>`;

    container.innerHTML = html;
    document.querySelectorAll('.score-input').forEach(input => {
      input.onchange = function() {
        const h = Number(this.getAttribute('data-hole'));
        const pid = this.getAttribute('data-player');
        const val = this.value ? Number(this.value) : "";
        if (isNaN(val) || val < 1 || val > 15) return;
        const update = {};
        update[`players.${pid}.scores.${h}`] = val;
        firestore.collection('games').doc(gameId).update(update);
      }
    });
  }

  window.copyToClipboard = function(text) {
    navigator.clipboard.writeText(text).then(() => {
      alert('Game ID copied to clipboard!');
    });
  };

  function showError(msg) {
    document.getElementById('pardleScorecardContainer').innerHTML =
      `<div style="color:#ff5252;font-weight:600;padding:2em;text-align:center;">${msg}</div>`;
  }
  </script>
</body>
</html>
